---
lang: zh-CN
title: 工程化之打包工具 webpack
description: webpack


> 官方文档参考：[gulpjs](https://gulpjs.com/docs/en/getting-started/quick-start)   
> 本案例参考当前项目内 demo：@/demo/gulp-demo  
> 开发环境：yarn v1.22.22、gulp: "^5.0.1"

### 安装与使用

- 初始化项目，生成 `package.json`

```
$ mkdir gulp-demo
$ cd gulp-demo
$ npm init -y
```

- 安装 gulp

```
$ yarn add gulp -D
$ npx gulp --version # 判断安装成功
```

- 在 `package.json` 配置脚本

```json title="@/package.json"
"scripts": {
  "build": "gulp"
}
```

- 根目录创建 `gulpfile.js`，初始化

```js title="@/gulpfile.js"
// 压缩js uglifyjs
function js () {
    console.log('this is js scripts task')
}
// 对scss/less编译，压缩，输出css文件
function css () {
    console.log('this is css styles task')
}
// 监听这些文件的变化
function watcher () {
    
}
// 删除dist目录中的内容
function clean () {
    
}
exports.scripts = js
exports.styles = css
exports.default = function () {
    console.log('hello gulp')
}
```

- 运行一个task

```
$ npx gulp scripts
```



### 插件介绍

> 插件官网参考：[gulp-插件](https://gulpjs.com/plugins/)   


常用插件：
* gulp-uglify 代码混淆
* gulp-rename 重命名
* del 清空dist目录
* gulp-autoprefixer 样式的预处理
* gulp-sass css预编译
* gulp-load-plugins 自动加载插件

### 配置glup

- 安装插件

```
$ yarn add gulp-uglify gulp-rename del gulp-autoprefixer gulp-sass gulp-load-plugins -D
```

- gulpfile.js中引入gulp-load-plugins以及我们要使用到的gulp的方法

```js title="@/gulpfile.js"
const { src, dest, series, watch } = require('gulp')
const plugins = require('gulp-load-plugins')()

```
#### gulp-uglify：改写压缩JS方法
- 在js方法中，使用src()方法来指定要压缩的JS文件路径，然后通过pipe()方法将流传递给uglify插件进行压缩。最后，再通过dest()方法将处理后的结果输出到指定的目录下。
```js title="@/gulpfile.js"
function js (cb) {
    src('*.js') // 源文件
    	.pipe(plugins.uglify()) // 压缩
    	.pipe(dest('./dist/js')) // 输出
        console.log('this is js scripts task')
    cb() // 回调函数
}
```
- 验证：创建index.js， 运行`npx gulp scripts`，查看dist目录下是否生成压缩后的js文件


#### del：清空dist目录

- 引入del插件，在clean方法中调用del.sync()方法来清空dist目录。

```js title="@/gulpfile.js"
// 说明：del插件无gulp-开头，无法通过plugins插件直接使用，需要单独引入
const del = (...args) => import('del').then(m => m.deleteAsync(...args))
async function clean () {
    await del('./dist')
}
```
- 验证：运行`npx gulp clean`，查看dist目录是否被清空


#### gulp-sass、gulp-autoprefixer：改写css处理

* 下载sass插件
* 引入gulp-autoprefixer插件，在css方法中调用sass和autoprefixer插件进行编译和添加浏览器前缀。
```js title="@/gulpfile.js"
const sass = require('gulp-sass')(require('sass'));
const autoprefixer = () => import('gulp-autoprefixer').then(m => m.default)
// 对scss/less编译，压缩，输出css文件
async function css (cb) {
    const autoprefixerPlugin = await autoprefixer()
    return src('*.scss')
    	.pipe(sass({ outputStyle: 'compressed' }))
        .pipe(autoprefixerPlugin({ cascade: false, remove: false })) 
    	.pipe(dest('./dist/css')) // 输出css文件
    cb()
}
```

在packge.json中配置browerslist，用于指定目标浏览器

```json title="@/package.json"
"browserslist": [
  "last 2 Version",
  "> 2%"
]
```

- 验证：创建index.scss， 运行`npx gulp styles`，查看dist目录下是否生成压缩后的css文件

#### watcher：监听文件变化

```js title="@/gulpfile.js"
const { src, dest, series, watch ,parallel} = require('gulp')
function watcher () {
    watch('js/*.js', js)
    watch('css/*.scss', css)
}
exports.default = function () {
    clean,
    parallel(js, css),
    watcher,
    console.log('hello gulp')
}
```

- 验证： 运行`npm run build`，修改js或scss文件，glup会监听文件变化，自动编译

### 热编译、浏览器自动刷新

- 安装依赖：

```
$ yarn add browser-sync -D
```

- 配置browserSync、创建serve任务

```js title="@/gulpfile.js"
const browserSync = require('browser-sync')
function serve (cb) {
    browserSync.init({
        server: {
            baseDir: './'
        }
    })
    cb()
}
```

- 引入reload方法，并改写js、css方法；增加default任务，增加serve方法

```js title="@/gulpfile.js"
const reload = browserSync.reload
function js (cb) {
    src('*.js') // 源文件
    	.pipe(plugins.uglify()) // 压缩
    	.pipe(dest('./dist/js')) // 输出
        .pipe(reload({ stream: true }))
        console.log('this is js scripts task')
    // cb() // 回调函数
}


// 对scss文件编译，压缩，输出css文件
async function css (cb) {
    const autoprefixerPlugin = await autoprefixer()
    return src('*.scss')
    	.pipe(sass({ outputStyle: 'compressed' }))
        .pipe(autoprefixerPlugin({ cascade: false, remove: false })) 
    	.pipe(dest('./dist/css')) // 输出css文件
        .pipe(reload({ stream: true }))
    // cb()
}
exports.default = series(
    clean,
    parallel(js, css),
    watcher,
    serve
)
```
创建index.html，运行`npm run build`，修改js或scss文件，浏览器会自动刷新