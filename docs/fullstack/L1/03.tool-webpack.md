---
lang: zh-CN
title: 工程化之打包工具 webpack
description: 项目需求分析：从业务需求到技术选型的全流程实践
---



> 本案例参考当前项目内 demo：@/webpack-practice-demo  
> 开发环境：Node v20.18.3 / npm v10.8.2

### 安装与使用

- 初始化项目，生成 `package.json`

```
$ cd webpack-practice-demo
$ npm init -y
```

- 安装 webpack（两种方式二选一）

```
# 方式一：项目本地安装
$ npm install webpack webpack-cli -D
$ ./node_modules/.bin/webpack --version  # 项目内查看版本

# 方式二：全局安装
$ npm install webpack webpack-cli -g
$ webpack --version  # 全局查看版本
```

- 在 `package.json` 配置脚本，通过 npm 调用 webpack

```json title="@/package.json"
"scripts": {
  "build": "webpack"
}
```

- 执行打包

```
$ npm run build
```

### 入口与输出

- 根目录创建 `index.js`（入口）与 `webpack.config.js`（配置）
- 未设置 `output` 时默认输出 `dist/main.js`
- 自定义输出可指定文件名与路径，例如 `dist/bundle.js`

```js title="@/webpack.config.js"
// 引入 path 模块
const path = require('path')

// console.log(path.resolve())
// console.log(path.join(__dirname, './dist'))

const config = {
  entry: './src/index.js',
  output: {
    filename: 'bundle.js',
    path: path.join(__dirname, './dist')
  }
}

module.exports = config
```

### loader、plugins

#### loader

> webpack 原生只理解 JavaScript / JSON；loader 让它能处理样式、图片等更多资源。

- 核心属性：
  - `test`：匹配需要转换的文件
  - `use`：声明转换所需的 loader 链
- 主要特性：
  - 支持链式调用（执行顺序从右到左）
  - loader 可同步也可异步
  - 运行在 Node.js 中，可执行任意 Node 功能

- 安装示例所需 loader

```
$ npm install css-loader style-loader sass-loader -D
$ npm install url-loader file-loader -D
```

```js title="@/webpack.config.js -- 配置 scss、图片 loader"
const config = {
  ...
  module: {
    rules: [
      {
        test: /(.scss|.sass)$/,
        use: ['style-loader', 'css-loader', 'sass-loader']
      },
      {
        test: /.(jpe?g|png|gif|svg)$/i,
        use: [
          {
            loader: 'url-loader', // 默认回退到 file-loader
            options: {
              limit: 10000,        // <10KB 转 base64
              name: '[name].[ext]',
              outputPath: 'imgs/'  // 超出 limit 的资源输出目录
            }
          }
        ]
      }
    ]
  }
}
```

#### plugins

> 插件是 webpack 的支柱能力，用于完成 loader 无法覆盖的构建流程。

- 安装示例插件

```
$ npm install html-webpack-plugin -D
```

```js title="@/webpack.config.js -- 配置 HtmlWebpackPlugin"
const HtmlWebpackPlugin = require('html-webpack-plugin')

const config = {
  ...
  plugins: [
    new HtmlWebpackPlugin({
      filename: 'index.html',   // dist 输出文件
      template: 'template.html' // 根目录模板
    })
  ]
}
```

### HMR（Hot Module Replacement）

#### 热编译（watch）

> `webpack --watch` 会监听文件变更并自动打包，但不会刷新浏览器。

- 在 `package.json` 添加脚本

```js title="@/package.json"
"scripts": {
  "watch": "webpack --watch"
}
```

- 运行 `npm run watch`，文件保存后会自动重新打包

#### 热更新（webpack-dev-server）

- 安装 dev server

```
$ npm install webpack-dev-server -D
```

- 配置脚本与 `devServer`

```js title="@/package.json"
"scripts": {
  "hot": "webpack-dev-server"
}
```

```js title="@/webpack.config.js"
const config = {
  ...
  devServer: {
    hot: true
  }
}
```

- 运行 `npm run hot`，访问 `http://localhost:8080`，保存后即可自动编译并刷新

### 模式

- webpack 提供 `development` / `production` 两种模式，可按需切换

```js title="@/webpack.config.js"
// production
const prodConfig = {
  mode: 'production',
  ...
}

// development
const devConfig = {
  mode: 'development',
  ...
}
```

- 结合 `process.env.NODE_ENV` 区分环境逻辑

```js title="@/index.js"
if (process.env.NODE_ENV === 'development') {
  console.log('baseurl is localhost')
} else {
  console.log('baseurl is imooc.com')
}
```

### Babel 配置

> Babel 将 ECMAScript 2015+ 转译为兼容旧浏览器的 JavaScript。

- 安装依赖

```
$ npm install @babel/core babel-loader @babel/preset-env @babel/plugin-transform-runtime -D
$ npm install @babel/runtime -S
```

- 创建 `.babelrc`

```json title="@/.babelrc"
{
  "presets": [
    "@babel/preset-env"
  ],
  "plugins": [
    "@babel/plugin-transform-runtime"
  ]
}
```

- 在 `webpack.config.js` 中启用 Babel

```js title="@/webpack.config.js"
const config = {
  module: {
    rules: [
      {
        test: /.js$/,
        loader: 'babel-loader'
      }
    ]
  }
}
```

### clean-webpack-plugin、copy-webpack-plugin

> `clean-webpack-plugin`：构建前清理输出目录  
> `copy-webpack-plugin`：复制静态资源到输出目录

- 安装

```
$ npm install clean-webpack-plugin copy-webpack-plugin -D
```

- 配置

```js title="@/webpack.config.js"
const { CleanWebpackPlugin } = require('clean-webpack-plugin')
const CopyWebpackPlugin = require('copy-webpack-plugin')

const config = {
  ...
  plugins: [
    new CleanWebpackPlugin(),
    new CopyWebpackPlugin({
      patterns: [
        {
          from: path.join(__dirname, 'assets'),
          to: 'assets'
        }
      ]
    })
  ]
}
```

- 打包后，`dist/assets` 会包含复制的静态资源

### mini-css-extract-plugin、terser-webpack-plugin、css-minimizer-webpack-plugin

> `mini-css-extract-plugin`：抽离 CSS  
> `terser-webpack-plugin`：压缩 JS  
> `css-minimizer-webpack-plugin`：webpack 5 推荐的 CSS 压缩方案（替代 optimize-css-assets）

- 安装

```
$ npm install -D mini-css-extract-plugin terser-webpack-plugin css-minimizer-webpack-plugin
```

- 配置

```js title="@/webpack.config.js"
const TerserPlugin = require('terser-webpack-plugin')
const MiniCssExtractPlugin = require('mini-css-extract-plugin')
const CssMinimizerPlugin = require('css-minimizer-webpack-plugin')

const config = {
  module: {
    rules: [
      {
        test: /(.scss|.sass)$/,
        use: [MiniCssExtractPlugin.loader, 'css-loader', 'sass-loader']
      }
    ]
  },
  optimization: {
    minimizer: [
      new TerserPlugin(),
      new CssMinimizerPlugin()
    ]
  },
  plugins: [
    new MiniCssExtractPlugin({
      filename: '[name].css',
      chunkFilename: '[id].css'
    })
  ]
}
```

- 打包后，`dist` 中的 CSS 与 JS 均会被抽离并压缩

